<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags always come first -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">

	<title>Dynamic Form, Bootstrap 4 + Typeahead.js</title>

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">

	<style type="text/css">
		.hide {
			display: none;
		}
	</style>
</head>
<body>
	

	<div class="container">
		<h1>Dynamic Form, Bootstrap 4 + Typeahead.js</h1>
		<div class="row">
			<div class="col-xs-12" id="demoContainer">
				<form id="bookForm" method="post">
					<div class="form-group row" id="grp">
						<div class="col-sm-4">
							<input type="text" class="form-control" name="book[].title" placeholder="Title" />
						</div>
						<div class="col-sm-4">
							<input type="text" class="form-control" name="book[].isbn" placeholder="ISBN" />
						</div>
						<div class="col-sm-3">
							<input type="text" class="form-control" name="book[].price" placeholder="Price" />
						</div>
						<div class="col-sm-1">
							<button type="button" class="btn btn-default addButton">Add</button>
						</div>
					</div>
					<div class="" id="submit">
						<button type="submit" class="btn btn-default">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- The template for adding new field -->
	<div class="form-group row hide" id="bookTemplate">
		<div class="col-xs-4">
			<input type="text" class="form-control" name="title" placeholder="Title" />
		</div>
		<div class="col-xs-4">
			<input type="text" class="form-control" name="isbn" placeholder="ISBN" />
		</div>
		<div class="col-xs-3">
			<input type="text" class="form-control" name="price" placeholder="Price" />
		</div>
		<div class="col-xs-1">
			<button type="button" class="btn btn-default removeButton">Del</button>
		</div>
	</div>



	<!-- jQuery first, then Tether, then Bootstrap JS. -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.7/js/tether.min.js" integrity="sha384-XTs3FgkjiBgo8qjEjBk0tGmf3wPrWtA6coPfQDfFEY8AnYJwjalXCiosYRBIBZX8" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
	<script src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>


	<script type="text/javascript">
		var substringMatcher = function(strs) {
		  return function findMatches(q, cb) {
		    var matches, substringRegex;

		    // an array that will be populated with substring matches
		    matches = [];

		    // regex used to determine if a string contains the substring `q`
		    substrRegex = new RegExp(q, 'i');

		    // iterate through the pool of strings and for any string that
		    // contains the substring `q`, add it to the `matches` array
		    $.each(strs, function(i, str) {
		      if (substrRegex.test(str)) {
		        matches.push(str);
		      }
		    });

		    cb(matches);
		  };
		};

		var states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California',
		  'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii',
		  'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana',
		  'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota',
		  'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire',
		  'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota',
		  'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island',
		  'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont',
		  'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'
		];
		function initTypeahead($elem) {
			$($elem).typeahead({
			  hint: true,
			  highlight: true,
			  minLength: 1
			},
			{
			  name: 'states',
			  source: substringMatcher(states)
			});
		}

		
	</script>

	<script>
		$(document).ready(function() {
			initTypeahead('[name="book[].title"]');

			var bookIndex = 0;
			$('#bookForm').on('click', '.addButton', function() {
				bookIndex++;
				var $template = $('#bookTemplate'),
					$clone    = $template
										.clone()
										.removeClass('hide')
										.removeAttr('id')
										.attr('data-book-index', bookIndex)
										.insertBefore($('#submit'));
				$clone
					.find('[name="title"]').attr('required', 'required').end()
					.find('[name="isbn"]').attr('required', 'required').end()
					.find('[name="price"]').attr('required', 'required').end();

				initTypeahead('[data-book-index="'+ bookIndex +'"] [name="title"]');

			});

			$('#bookForm').on('click', '.removeButton', function() {
				var $row  = $(this).parents('.form-group'),
					index = $row.attr('data-book-index');

				$row.remove();
			});
		});
	</script>

</body>
</html>